dist: bionic

services:
  - docker

if: branch = master AND type = push

script:
  - echo "${DOCKER_PASSWORD}" | docker login -u "${DOCKER_USERNAME}" --password-stdin
  - docker build -t ${DOCKERHUB_ORG}/pspipe .
  - docker run --rm ${DOCKERHUB_ORG}/pspipe python -c "import pspipe"

after_success:
  - docker tag cmb/pspipe:latest ${DOCKERHUB_ORG}/pspipe:latest
  - docker push ${DOCKERHUB_ORG}/pspipe:latest
